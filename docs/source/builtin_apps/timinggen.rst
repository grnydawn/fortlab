.. _timinggen-app:


*********************
timinggen app
*********************

This app instruments the original code to insert timing generation code. The timing collection measures the elapsed time between the beginning and the end of the specified kernel region per every execu- tion from all threads and processes. For example, in case of MPI and OpenMP enabled software, the total number of mea- surements is the product of the number of invocations, the number of OpenMP threads, and the number of MPI ranks. The timing data is used to choose the best combinations of "invocation-OpenMP thread-MPI rank" that produces the kernel driving data whose timing statistics efficiently match to the statistics from the execution of the original software.
This app is invoked by using "timinggen" a subcommand in FortLab either in command-line or Python script. It receives a AST generated by "resolve" app. After instrumenting the code, the app compiles and runs the instrumented software to generate raw timing data, and finally it merges the timing raw data in an JSON-format file.

.. code-block:: json
   :linenos:

        {"etime": {
          "23": {
            "0": {
              "1": ["3.21706E+03", "3.21707E+03"],
              "2": ["3.21709E+03", "3.21710E+03"],
              "3":...
            }...
          }...
         }...
        }

Listing 10 shows the JSON content of "timinggen‚Äù app output. Line 1 shows the type of this JSON object. In this 12
13 means the MPI rank that the timing output is generated 14
case,thetypeiselapsedtime.Thenumber"23"inline2
from. Similarly, "0" in line 3 is the OpenMP thread number. The key values in line 4-6, means the order of invocations that the kernel region is executed. The array values of each invocation are timestamps of the beginning and the end of the kernel execution.

Example
************

Usage
************

usage: fortlab-timinggen [-h] [--version] [--cleancmd CLEANCMD] [--buildcmd build command] [--runcmd run command]
                                 [--outdir OUTDIR] [--no-cache]
                                 analysis

        positional arguments:
          analysis              analysis object

        optional arguments:
          -h, --help            show this help message and exit
          --version             show program's version number and exit
          --cleancmd CLEANCMD   Software clean command.
          --buildcmd build command
                                Software build command
          --runcmd run command  Software run command
          --outdir OUTDIR       output directory
          --no-cache            force to collect timing data

        This app may feed-forward following data to next app:
          etimedir (type=any)        elapsedtime instrumented code directory
          modeldir (type=any)        elapsedtime data directory
